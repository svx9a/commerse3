{% comment %}
  AR Product Showcase Section for O2O Theme
  Integrates WebXR capabilities with existing theme structure
{% endcomment %}

{%- liquid
  assign section_id = 'ar-showcase-' | append: section.id
  assign heading = section.settings.heading | default: 'Experience in AR'
  assign subheading = section.settings.subheading
  assign padding_top = section.settings.padding_top | default: 60
  assign padding_bottom = section.settings.padding_bottom | default: 60
-%}

<section 
  id="{{ section_id }}" 
  class="ar-product-showcase liquid-enhanced magnetic-element"
  style="padding-top: {{ padding_top }}px; padding-bottom: {{ padding_bottom }}px;"
  data-section-type="ar-showcase"
  data-section-id="{{ section.id }}"
>
  <div class="container">
    
    {% if heading != blank or subheading != blank %}
    <div class="ar-showcase-header text-center">
      {% if heading != blank %}
        <h2 class="ar-showcase-title luxury-text">
          {{ heading }}
        </h2>
      {% endif %}
      
      {% if subheading != blank %}
        <p class="ar-showcase-subtitle">
          {{ subheading }}
        </p>
      {% endif %}
    </div>
    {% endif %}
    
    <div class="ar-showcase-content">
      
      {% comment %} Individual AR Products {% endcomment %}
      {% if section.blocks.size > 0 %}
        <div class="ar-products-grid">
          {% for block in section.blocks %}
            {% case block.type %}
              
              {% when 'ar_product' %}
                <div 
                  class="ar-product-item magnetic-element"
                  data-block-id="{{ block.id }}"
                  {{ block.shopify_attributes }}
                >
                  <div class="ar-product-content">
                    
                    {% if block.settings.product_title != blank %}
                      <h3 class="ar-product-title">{{ block.settings.product_title }}</h3>
                    {% endif %}
                    
                    {% if block.settings.product_description != blank %}
                      <p class="ar-product-description">{{ block.settings.product_description }}</p>
                    {% endif %}
                    
                    <div 
                      class="ar-product-viewer magnetic-element"
                      data-model-url="{{ block.settings.model_url }}"
                      data-scale="{{ block.settings.model_scale | default: 1 }}"
                      data-auto-rotate="{{ block.settings.auto_rotate | default: false }}"
                      data-enable-shadows="{{ block.settings.enable_shadows | default: true }}"
                      data-light-intensity="{{ block.settings.light_intensity | default: 1.2 }}"
                      aria-label="3D model of {{ block.settings.product_title | default: 'product' }}"
                    >
                      {% comment %} AR viewer will be initialized here by JavaScript {% endcomment %}
                      
                      {% if block.settings.fallback_image != blank %}
                        <div class="ar-fallback-image">
                          <img 
                            src="{{ block.settings.fallback_image | img_url: '800x600' }}"
                            alt="{{ block.settings.product_title | default: 'Product image' }}"
                            loading="lazy"
                          >
                        </div>
                      {% endif %}
                    </div>
                    
                    {% if block.settings.product_link != blank %}
                      <div class="ar-product-actions">
                        <a 
                          href="{{ block.settings.product_link }}" 
                          class="btn btn-primary magnetic-element"
                          aria-label="View {{ block.settings.product_title | default: 'product' }} details"
                        >
                          {{ block.settings.button_text | default: 'View Product' }}
                        </a>
                      </div>
                    {% endif %}
                    
                  </div>
                </div>
              
              {% when 'ar_gallery' %}
                <div 
                  class="ar-gallery-item"
                  data-block-id="{{ block.id }}"
                  {{ block.shopify_attributes }}
                >
                  <div class="ar-gallery-content">
                    
                    {% if block.settings.gallery_title != blank %}
                      <h3 class="ar-gallery-title">{{ block.settings.gallery_title }}</h3>
                    {% endif %}
                    
                    <div class="ar-gallery-grid">
                      {% assign gallery_items = block.settings.gallery_models | split: ',' %}
                      {% for item in gallery_items limit: 6 %}
                        {% assign item_data = item | split: '|' %}
                        {% if item_data.size >= 2 %}
                          <div 
                            class="ar-gallery-viewer magnetic-element"
                            data-model-url="{{ item_data[0] | strip }}"
                            data-scale="{{ item_data[1] | strip | default: 1 }}"
                            data-auto-rotate="true"
                            data-enable-shadows="true"
                          >
                            {% if item_data.size >= 3 %}
                              <div class="ar-gallery-label">{{ item_data[2] | strip }}</div>
                            {% endif %}
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                    
                  </div>
                </div>
              
              {% when 'ar_experience' %}
                <div 
                  class="ar-experience-item"
                  data-block-id="{{ block.id }}"
                  {{ block.shopify_attributes }}
                >
                  <div class="ar-experience-content">
                    
                    {% if block.settings.experience_title != blank %}
                      <h3 class="ar-experience-title">{{ block.settings.experience_title }}</h3>
                    {% endif %}
                    
                    {% if block.settings.experience_description != blank %}
                      <p class="ar-experience-description">{{ block.settings.experience_description }}</p>
                    {% endif %}
                    
                    <div 
                      class="ar-product-viewer ar-experience-viewer magnetic-element"
                      data-model-url="{{ block.settings.experience_model }}"
                      data-scale="{{ block.settings.experience_scale | default: 1.5 }}"
                      data-auto-rotate="{{ block.settings.auto_rotate | default: true }}"
                      data-enable-shadows="true"
                      data-light-intensity="{{ block.settings.light_intensity | default: 1.5 }}"
                      data-experience-mode="true"
                    >
                      {% if block.settings.experience_fallback != blank %}
                        <div class="ar-fallback-image">
                          <img 
                            src="{{ block.settings.experience_fallback | img_url: '1200x800' }}"
                            alt="{{ block.settings.experience_title | default: 'AR experience' }}"
                            loading="lazy"
                          >
                        </div>
                      {% endif %}
                    </div>
                    
                    <div class="ar-experience-features">
                      {% if block.settings.feature_1 != blank %}
                        <div class="ar-feature">
                          <span class="ar-feature-icon">âœ¨</span>
                          <span class="ar-feature-text">{{ block.settings.feature_1 }}</span>
                        </div>
                      {% endif %}
                      
                      {% if block.settings.feature_2 != blank %}
                        <div class="ar-feature">
                          <span class="ar-feature-icon">ðŸŽ¯</span>
                          <span class="ar-feature-text">{{ block.settings.feature_2 }}</span>
                        </div>
                      {% endif %}
                      
                      {% if block.settings.feature_3 != blank %}
                        <div class="ar-feature">
                          <span class="ar-feature-icon">ðŸ“±</span>
                          <span class="ar-feature-text">{{ block.settings.feature_3 }}</span>
                        </div>
                      {% endif %}
                    </div>
                    
                  </div>
                </div>
            
            {% endcase %}
          {% endfor %}
        </div>
      {% endif %}
      
    </div>
  </div>
  
  {% comment %} Liquid depth layers for enhanced visual effects {% endcomment %}
  <div class="liquid-depth-layer liquid-depth-1"></div>
  <div class="liquid-depth-layer liquid-depth-2"></div>
  <div class="liquid-depth-layer liquid-depth-3"></div>
  
</section>

<style>
  /* Section-specific styles */
  .ar-product-showcase {
    position: relative;
    background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
    overflow: hidden;
  }
  
  .ar-showcase-header {
    margin-bottom: 60px;
  }
  
  .ar-showcase-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 20px;
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
  }
  
  .ar-showcase-subtitle {
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.8);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }
  
  .ar-products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 40px;
    margin-top: 40px;
  }
  
  .ar-product-item,
  .ar-gallery-item,
  .ar-experience-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 30px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .ar-product-item:hover,
  .ar-gallery-item:hover,
  .ar-experience-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-4px);
  }
  
  .ar-product-title,
  .ar-gallery-title,
  .ar-experience-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 15px;
  }
  
  .ar-product-description,
  .ar-experience-description {
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 25px;
    line-height: 1.6;
  }
  
  .ar-gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  .ar-gallery-viewer {
    height: 200px;
    border-radius: 8px;
    position: relative;
  }
  
  .ar-gallery-label {
    position: absolute;
    bottom: 10px;
    left: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: #ffffff;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    text-align: center;
    backdrop-filter: blur(10px);
  }
  
  .ar-experience-features {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 25px;
  }
  
  .ar-feature {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    font-size: 0.9rem;
    color: #ffffff;
  }
  
  .ar-feature-icon {
    font-size: 1.1rem;
  }
  
  .ar-product-actions {
    margin-top: 25px;
    text-align: center;
  }
  
  .ar-fallback-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
  }
  
  .ar-fallback-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    border-radius: 8px;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .ar-products-grid {
      grid-template-columns: 1fr;
      gap: 30px;
    }
    
    .ar-product-item,
    .ar-gallery-item,
    .ar-experience-item {
      padding: 20px;
    }
    
    .ar-gallery-grid {
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .ar-gallery-viewer {
      height: 150px;
    }
  }
</style>

{% schema %}
{
  "name": "AR Product Showcase",
  "tag": "section",
  "class": "section-ar-showcase",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Experience in AR"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "info": "Optional description text"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 120,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "ar_product",
      "name": "AR Product",
      "settings": [
        {
          "type": "text",
          "id": "product_title",
          "label": "Product Title"
        },
        {
          "type": "textarea",
          "id": "product_description",
          "label": "Product Description"
        },
        {
          "type": "url",
          "id": "model_url",
          "label": "3D Model URL",
          "info": "URL to GLTF/GLB model file"
        },
        {
          "type": "range",
          "id": "model_scale",
          "min": 0.1,
          "max": 5.0,
          "step": 0.1,
          "label": "Model Scale",
          "default": 1.0
        },
        {
          "type": "checkbox",
          "id": "auto_rotate",
          "label": "Auto Rotate",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "enable_shadows",
          "label": "Enable Shadows",
          "default": true
        },
        {
          "type": "range",
          "id": "light_intensity",
          "min": 0.5,
          "max": 3.0,
          "step": 0.1,
          "label": "Light Intensity",
          "default": 1.2
        },
        {
          "type": "image_picker",
          "id": "fallback_image",
          "label": "Fallback Image",
          "info": "Shown when 3D model fails to load"
        },
        {
          "type": "url",
          "id": "product_link",
          "label": "Product Link"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "View Product"
        }
      ]
    },
    {
      "type": "ar_gallery",
      "name": "AR Gallery",
      "settings": [
        {
          "type": "text",
          "id": "gallery_title",
          "label": "Gallery Title"
        },
        {
          "type": "textarea",
          "id": "gallery_models",
          "label": "Gallery Models",
          "info": "Format: model_url|scale|label, one per line"
        }
      ]
    },
    {
      "type": "ar_experience",
      "name": "AR Experience",
      "settings": [
        {
          "type": "text",
          "id": "experience_title",
          "label": "Experience Title"
        },
        {
          "type": "textarea",
          "id": "experience_description",
          "label": "Experience Description"
        },
        {
          "type": "url",
          "id": "experience_model",
          "label": "Experience Model URL"
        },
        {
          "type": "range",
          "id": "experience_scale",
          "min": 0.5,
          "max": 3.0,
          "step": 0.1,
          "label": "Experience Scale",
          "default": 1.5
        },
        {
          "type": "checkbox",
          "id": "auto_rotate",
          "label": "Auto Rotate",
          "default": true
        },
        {
          "type": "range",
          "id": "light_intensity",
          "min": 0.5,
          "max": 3.0,
          "step": 0.1,
          "label": "Light Intensity",
          "default": 1.5
        },
        {
          "type": "image_picker",
          "id": "experience_fallback",
          "label": "Fallback Image"
        },
        {
          "type": "text",
          "id": "feature_1",
          "label": "Feature 1"
        },
        {
          "type": "text",
          "id": "feature_2",
          "label": "Feature 2"
        },
        {
          "type": "text",
          "id": "feature_3",
          "label": "Feature 3"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "AR Product Showcase",
      "blocks": [
        {
          "type": "ar_product"
        }
      ]
    }
  ]
}
{% endschema %}